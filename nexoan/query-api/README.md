# Query API

## Implement OpenAPI Contract

‚ö†Ô∏è **Warning**  
You should have the Ballerina version of **2201.11.0** in your device. You can download it by following link
```bash
https://ballerina.io/downloads/archived/#swan-lake-archived-versions
```

The Ballerina service can be generated by the following command. 

> üí° Note: Always make sure the contract has the expected endpoints and request params
> before working on the code. The generated endpoints should not be editable at all. 
> Maybe the only changes that can be done is adding error handlers, but request and response
> must be defined in the contract. 
> Note that this will create the query_api_service.bal file and types.bal file

```bash
bal openapi -i ../contracts/rest/query_api.yaml --mode service
```

## Generate GRPC Stubs

The client stub generated here will be sending and receiving values via Grpc. 
This will send requests to the corresponding CRUD server endpoint. 
This command will generate the types_v1_pb.bal file

```bash
bal grpc --mode client --input ../crud-api/protos/types_v1.proto --output .
```

## Development

‚ö†Ô∏è **Warning**  
All the commands here are for the **LINUX** & **macOS**, but they work on the **Windows** too. but for the commands which does not works on the **Windows** We have given the working command by mentioning that. Please look for that.

For LINUX & macOS
```bash
cd nexoan/query-api
cp env.template .env
# update the required fields to set the environment variables
# (you can find the example env configurations here)
source .env
# make sure crud service is running
bal test
bal run
```

For windows (make sure you open the **Powershell CLI**)
```bash
cd nexoan/query-api
echo .env
# after updating the required fields to be added to the environment
# you have to copy and paste the env configurations on the Powershell CLI
# (you can find the example env configurations here)
# make sure crud service is running
bal test
bal run
```

Example .env configurations
```bash
# For LINUX & macOS
export CRUD_SERVICE_HOST=localhost
export CRUD_SERVICE_PORT=50051
export QUERY_SERVICE_HOST=localhost
export QUERY_SERVICE_PORT=8081

# For Windows (paste on Powershell CLI)
$env:CRUD_SERVICE_HOST="localhost"
$env:CRUD_SERVICE_PORT="50051"
$env:QUERY_SERVICE_HOST="localhost"
$env:QUERY_SERVICE_PORT="8081"
```


